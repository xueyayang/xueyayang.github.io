---
layout: default
---

一种trick的Debug方法
====================

1 问题
====
开发Android的NDK程序，不会用debug工具。调用一个空的`默认`构造函数后，报`segmentation fault`。
其实当时应该反应过来，问题在析构函数里，但没有。就是想知道，调用构造函数后，程序都执行到了哪里。

2 方法
====
在每条语句后加上输出行号的命令。
{% highlight c%}
cout<<__LINE__<<endl;
{% endhighlight %}

手工加的话太麻烦，幸好有VIM。
{% highlight bash %}
%s/{$/{^Mcout\<\<__LINE__\<\<endl;/g
{% endhighlight %}

作用：将每一个左大括号`{`后面，添加一行`cout<<__LINE__<<endl;`。不要忘了分号。

妙处：

1. 进入每个函数，会输出行号。
2. 进入每个分支，会输出行号。（当然要有括号）

为什么不每一行后都加呢？只选择在括号后加？——因为那样程序就编译不过去了。
想想在`#include <xxx>`后加，显然是不能执行的。

运用这种方法，轻易捕捉到，析构函数进入了一个不该进入的分支。原因是空的构造函数
没有对一个成员指针变量置`NULL`。导致判断指针是否为空时，返回了`true`。——很常见
的未初始化错误。

3 总结
====
- 做这种trick的大改之前，记得版本控制！随时准备revert/roll back，不然麻烦无穷。
- VIM加正则，威力无边。
- 对于复杂的析构函数，这种方法很有必要。

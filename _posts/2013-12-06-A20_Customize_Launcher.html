<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/TR/2001/REC-MathML2-20010221/dtd/xhtml-math11-f.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="GENERATOR" content="LyX 2.0.6" />
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<title>A20设定默认Launcher</title>

<!-- Text Class Preamble -->
<style type="text/css">
div.toc {
margin: 2em 0em;
border-style: solid;
border-width: 2px 0px;
padding: 1em 0em;
}
div.tochead { font-size: x-large; font-weight: bold; }
div.lyxtoc-0 {
margin: 2em 0em 0em 0em;
font-size: xx-large;
font-weight: bold;
}
div.lyxtoc-1 {
margin: 1em 0em 0em 0em;
font-size: x-large;
font-weight: bold;
}
div.lyxtoc-2 {
margin: 0em 0em 0em 1em;
font-size: large;
font-weight: normal;
}
div.lyxtoc-3 { margin: 0em 0em 0em 0.5em; font-size: medium; }
div.lyxtoc-4 { margin: 0em 0em 0em 0.5em; }
div.lyxtoc-5 { margin: 0em 0em 0em 0.5em; }
div.lyxtoc-6 { margin: 0em 0em 0em 0.5em; }
a.tocentry {
text-decoration: none;
color: black;
}
a.tocentry:visited { color: black; }
a.tocarrow {
font-weight: bold;
text-decoration: none;
color: #909090;
}
a.tocarrow:visited { color: #C0C0C0; }
</style>

<!-- Preamble Snippets -->

<!-- Layout-provided Styles -->
<style type='text/css'>
h1.title {
font-size: x-large;
margin-bottom: 1ex;
text-align: center;

}
h2.section {
font-weight: bold;
font-size: x-large;
margin-top: 1.3ex;
margin-bottom: 0.7ex;
text-align: left;

}
div.standard {
margin-bottom: 2ex;
}
ul.itemize {
margin-top: 0.7ex;
margin-bottom: 0.7ex;
margin-left: 3ex;
text-align: left;

}
div.plain_layout {
text-align: left;

}
ol.enumerate {
margin-top: 0.7ex;
margin-bottom: 0.7ex;
margin-left: 3ex;
text-align: left;

}
h3.subsection {
font-weight: bold;
font-size: large;
margin-top: 0.9ex;
margin-bottom: 0.5ex;
text-align: left;

}
div.listings {
font-family: monospace;
}
</style>
</head>
<body>
<h1 class="title"><a id='magicparlabel-3' />
A20设定默认Launcher</h1>
<h2 class="section"><span class="section_label">1</span> <a id='magicparlabel-4' />
问题</h2>
<div class="standard"><a id='magicparlabel-5' />
将ROM（A20-Homelet）的Launcher设置为“兔子视频”。即盒子启动后，直接进入兔子视频，而不是需要用户来选择：</div>

<ul class="itemize"><li class="itemize_item"><a id='magicparlabel-6' />
进入兔子视频还是其它Launcher？</li>
<li class="itemize_item"><a id='magicparlabel-7' />
是Always呢还是JustOnce？</li>
</ul>
<h2 class="section"><span class="section_label">2</span> <a id='magicparlabel-8' />
手册怎么说</h2>
<div class="standard"><a id='magicparlabel-9' />
随源码的手册在：</div>

<div class="standard"><a id='magicparlabel-10' />
其中12.1节提到：</div>
<div class='float float-listings'><pre>$A20_SRC/lichee/tools/tools_win/Documentations/sugar定制化说明.pdf</pre></div>


<div class="standard"><a id='magicparlabel-15' />
<img src='0D__Document_A20___Launcher_images_defaultLaucher.png' alt='image: 0D__Document_A20___Launcher_images_defaultLaucher.png' />
</div>

<div class="standard"><a id='magicparlabel-16' />
需要注意的地方：</div>

<ol class="enumerate"><li class="enumerate_item"><a id='magicparlabel-17' />
sugar-ref001工程代号，此次修改的，应该是sugar-xbh_fjb.mk。(代号含义不详。）</li>
<li class="enumerate_item"><a id='magicparlabel-18' />
com.softwinner.laucher及com.softwinner.laucher.Luacher，显然应该换成兔子视频的包名与类名</li>
</ol>
<h2 class="section"><span class="section_label">3</span> <a id='magicparlabel-19' />
如何得到第三方APK包的信息</h2>
<div class="standard"><a id='magicparlabel-20' />
Android SDK提供了一个叫aapt（Android Asset Package Tool）的工具，与adb在同一目录下（android-sdks/platform-tools）。</div>
<h3 class="subsection"><span class="subsection_label">3.1</span> <a id='magicparlabel-21' />
aapt的命令</h3>
<div class="standard"><a id='magicparlabel-22' />
<img src='1D__Document_A20___Launcher_images_badging.png' alt='image: 1D__Document_A20___Launcher_images_badging.png' />
</div>

<div class="standard"><a id='magicparlabel-23' />
我们使用该工具的dump选项，输出badging信息。</div>
<h3 class="subsection"><span class="subsection_label">3.2</span> <a id='magicparlabel-24' />
使用aapt得到包信息</h3>
<div class="standard"><a id='magicparlabel-25' />
<img src='2D__Document_A20___Launcher_images_pkg-info.png' alt='image: 2D__Document_A20___Launcher_images_pkg-info.png' />
</div>

<div class="standard"><a id='magicparlabel-26' />
这样，得到了需要的包名与类名信息：</div>

<div class="standard"><a id='magicparlabel-27' />
</div>
<div class='float float-listings'><pre>com.luxtone.tuzi3
com.luxtone.tuzi3.activity.Main</pre></div>

<h3 class="subsection"><span class="subsection_label">3.3</span> <a id='magicparlabel-33' />
其它方法</h3>
<div class="standard"><a id='magicparlabel-34' />
必须说明，这只是众多方法的一种。如果对Android开发较熟悉，可以用原生API编程来得到包信息；或者使用一些反编译工具，直接得到AndroidManifest.xml。</div>
<h2 class="section"><span class="section_label">4</span> <a id='magicparlabel-35' />
不生效的处理</h2>
<div class="standard"><a id='magicparlabel-36' />
按照手册，到目录：</div>

<div class="standard"><a id='magicparlabel-37' />
</div>
<div class='float float-listings'><pre>$A20_SRC/android/device/softwinner/sugar-xbh_fjb</pre></div>


<div class="standard"><a id='magicparlabel-42' />
下找到文件sugar_xbh_fjb.mk，为变量PRODUCT_PROPERTY_OVERRIDES增添两个选项：</div>

<div class="standard"><a id='magicparlabel-43' />
</div>
<div class='float float-listings'><pre>ro.sw.defaultlauncherpackage=com.luxtone.tuzi3 \ 
ro.sw.defaultlauncherclass=com.luxtone.tuzi3.activity.Main \</pre></div>


<div class="standard"><a id='magicparlabel-49' />
重新编译、打包、烧录，启动盒子，发现却并不生效。</div>
<h3 class="subsection"><span class="subsection_label">4.1</span> <a id='magicparlabel-50' />
修改代码</h3>
<div class="standard"><a id='magicparlabel-51' />
根据从网上找的资料，在目录：</div>
<div class='float float-listings'><pre>$A20_SRC/android/frameworks/base/services/java/com/android/server/am</pre></div>


<div class="standard"><a id='magicparlabel-56' />
找到文件ActivityManagerService.java。</div>

<div class="standard"><a id='magicparlabel-57' />
增加如下函数：</div>

<div class="standard"><a id='magicparlabel-58' />
<img src='3D__Document_A20___Launcher_images_code_all.png' alt='image: 3D__Document_A20___Launcher_images_code_all.png' />
</div>

<div class="standard"><a id='magicparlabel-59' />
并将此函数加入到startHomeActivityLocked()中：</div>

<div class="standard"><a id='magicparlabel-60' />
<img src='4D__Document_A20___Launcher_images_code_call.PNG' alt='image: 4D__Document_A20___Launcher_images_code_call.PNG' />
</div>

<div class="standard"><a id='magicparlabel-61' />
一点小细节，代码中的mFirstLaunch变量，也是需要改动者自己添加的。图中未予列出。</div>
<h3 class="subsection"><span class="subsection_label">4.2</span> <a id='magicparlabel-62' />
A20已经做的工作</h3>
<div class="standard"><a id='magicparlabel-63' />
事实上，上面提到的函数，A20的源码包中已经实现。但在startHomeActivityLocked()中，对该函数的调用却又被注释掉，原因不详。因此，如果只是针对A20的开发，只需要把这句代码放开即可。不需要做额外的工作。</div>
<h2 class="section"><span class="section_label">5</span> <a id='magicparlabel-64' />
原理</h2>
<div class="standard"><a id='magicparlabel-65' />
这是一份HOW-TO的手册，关于原理不作说明。事实上也尚未研究。但从代码里看出，以下几方面应该进一步研究：</div>

<ol class="enumerate"><li class="enumerate_item"><a id='magicparlabel-66' />
sugar-xbh_fjb.mk中的PRODUCT_PROPERTY_OVERRIDES变量，值是如何流动的。</li>
<li class="enumerate_item"><a id='magicparlabel-67' />
一个Launchable的APK与非Launchable的APK的区别。</li>
<li class="enumerate_item"><a id='magicparlabel-68' />
IPackageManager类提供的API及在android framework中的作用。</li>
<li class="enumerate_item"><a id='magicparlabel-69' />
如果去掉mFirstLaunch的检验，是否可以永远去除切换到其它Launcher的可能。</li>
</ol>
<h2 class="section"><span class="section_label">6</span> <a id='magicparlabel-70' />
总结</h2>
<div class="standard"><a id='magicparlabel-71' />
简洁讲，针对A20，定制默认Launcher，Step-By-Step的操作应该是：</div>

<ol class="enumerate"><li class="enumerate_item"><a id='magicparlabel-72' />
为sugar-xbh_fjb.mk文件中的PRODUCT_PROPERTY_OVERRIDES变量添加两项其中，包名和类名是从兔子视频的APK包中获取的。</li>
<li class="enumerate_item"><a id='magicparlabel-78' />
到目录中，找到ActivityManagerService.java文件，并将2299行注释放开。</li>
</ol>
</body>
</html>
